(()=>{var d=class{constructor(t,o){let{mapKey:e}=t.dataset,s=JSON.parse(t.querySelector("[data-location-list-json]").innerHTML);s.features.forEach((n,r)=>{n.properties.id=r}),mapboxgl.accessToken=e,this.map=new mapboxgl.Map({container:o,style:"mapbox://styles/mapbox/streets-v11",center:s.features[0].geometry.coordinates,zoom:9}),this.map.on("load",()=>{this.buildLocationList(t,s),this.addMarkers(s),this.createPopup(s.features[0])}),this.initFilterStore(t),this.handlerSelectedStoreLOcation(s,t)}createPopup({geometry:t,properties:o}){let e=document.getElementsByClassName("mapboxgl-popup");e[0]&&e[0].remove(),new mapboxgl.Popup({offset:25,closeOnClick:!1}).setLngLat(t.coordinates).setText(o["Full Address"]).addTo(this.map)}buildLocationList(t,o){t.querySelector(".js-find-store-location-list").children.forEach(s=>{let{lat:n,long:r}=s.dataset;s.addEvent("click",()=>{let a=o.features.find(({properties:{Latitude:l,Longitude:i}})=>l==n&&i==r);AT.cookie.set("arn-selected-store-location",JSON.stringify(a),14),document.dispatchEvent(new CustomEvent("store-location-change")),this.map.jumpTo({center:a.geometry.coordinates}),this.createPopup(a)})})}addMarkers(t){for(let o of t.features){let e=document.querySelector(".marker.template").cloneNode(!0);e.removeClass("d-none","template"),e.id=`marker-${o.properties.id}`,new mapboxgl.Marker(e).setLngLat(o.geometry.coordinates).addTo(this.map),e.addEventListener("click",s=>{this.createPopup(o)})}}initFilterStore(t){let o=t.querySelector(".js-find-store-location-country"),e=t.querySelector(".js-find-store-location-city"),s=t.querySelector(".js-find-store-location-list");o.addEvent("change",function(){let n=JSON.parse(this.options[this.selectedIndex].dataset.cities);e.innerHTML=e.options[0].outerHTML,n.forEach(r=>{let a=document.createElement("option");a.innerText=r,a.value=r,e.appendChild(a)})}),e.addEvent("change",function(){let n=o.value;s.children.forEach(r=>{let{city:a,country:l}=r.dataset;n==l&&a==this.value?r.removeClass("d-none"):r.addClass("d-none")})})}handlerSelectedStoreLOcation(t,o){let e=JSON.parse(AT.cookie.get("arn-selected-store-location"));if(!e)return;let{Country:s,City:n,Latitude:r,Longitude:a}=e.properties,l=o.querySelector(".js-find-store-location-country"),i=o.querySelector(".js-find-store-location-city"),u=o.querySelector(".js-find-store-location-list");l.value=s,l.dispatchEvent(new Event("change")),i.value=n,i.dispatchEvent(new Event("change"));let c=[...u.children].find(p=>p.dataset.lat==r&&p.dataset.long==a);console.log(c),c&&c.click()}};register("store-location",{onLoad(){new d(this.container,"map")}});load("store-location");console.log("store-location-page.js loaded");})();
