(()=>{var C={onLoad(){this.elms={cartSubtotalPrice:this.container.querySelector(".js-cart-subtotal-price"),cartTotalPrice:this.container.querySelector(".js-cart-total-price"),lineItemList:this.container.getElementsByClassName("js-cart-line-item"),lineItemsContainer:this.container.querySelector("#cart-line-items"),estimateShipping:this.container.querySelector("#shipping-calculator"),cartForm:this.container.querySelector("#cart-form"),cartNote:this.container.querySelector("#cart-note"),checkoutSubmitButton:this.container.querySelector("#checkout-submit-button")},document.addEvent("cart-change",this.onCartChangeHandler.bind(this)),document.addEvent("cart-add",this.onCartAddHandler.bind(this)),this.initEstimateShipping(),this.initCartNote(),this.initCheckoutSubmitButton()},onCartAddHandler({detail:{sections:e,...t}}){let{lineItemsContainer:n}=this.elms;n.innerHTML=e["cart-template"];let a=n.querySelector(`cart-line-item[data-key='${t.key}']`);AT.scrollTo(a,1e3,300).then(()=>{a.addClass("line-item--highlight"),AT.debounce(()=>a.removeClass("line-item--highlight"),1e3)})},onCartChangeHandler({detail:{original_total_price:e,total_price:t,item_count:n}}){let{cartSubtotalPrice:a,cartTotalPrice:s}=this.elms;a.innerHTML=e.toCurrency(),s.innerHTML=t.toCurrency(),this.container.setAttribute("data-status",n)},initEstimateShipping(){let{estimateShipping:e}=this.elms;if(!e)return;let t=e.querySelector("form"),n=e.querySelector("#shipping-calculator-country"),a=e.querySelector("#shipping-calculator-province"),s=a.closest(".province"),o=e.querySelector(".js-message-container"),m=e.querySelector(".js-error-message"),i=e.querySelector(".js-shipping-calculator-results"),y=/\{\{\s*(\w+)\s*\}\}/,v="amount_no_decimals,amount_no_decimals_with_comma_separator,amount_no_decimals_with_space_separator",p=n.dataset.default;n.addEvent("change",function(){let u=JSON.parse(this.options[this.selectedIndex].dataset.provinces);u.length?(s.removeClass("d-none"),u.forEach(h=>{let l=document.createElement("option");l.value=h[0],l.innerHTML=h[1],a.append(l)})):(s.addClass("d-none"),a.value="")}),p&&(n.value=p,n.dispatchEvent(new Event("change"))),t.addEvent("submit",function(u){u.preventDefault();let h=new FormData(this),l=new URLSearchParams(h).toString();this.addClass("pending"),fetch(`/cart/shipping_rates.json?${l}`,{dataType:"json"}).then(({shipping_rates:r})=>{o.addClass("d-none"),console.log(r),r.length?(i.querySelector("p").innerHTML=r.length>1?theme.strings.shipping.manyRates.replace("{{number}}",r.length):theme.strings.shipping.oneRate,i.querySelector("ul").innerHTML=r.reduce((c,d)=>(c+=`<li>${d.name}: ${(v.includes(theme.currency.format.match(y)[1])?d.price*100:d.price).toCurrency()}</li>`,c),"")):(i.querySelector("ul").innerHTML="",i.querySelector("p").innerHTML=theme.strings.shipping.notFoundRate),i.removeClass("d-none")}).catch(r=>{let c=Object.keys(r)[0];m.innerHTML=`${c} ${r[c]}`,o.removeClass("d-none"),i.addClass("d-none")}).finally(()=>this.removeClass("pending"))})},initCartNote(){let{cartNote:e,cartForm:t}=this.elms;e&&e.querySelector("textarea").addEvent("input",function(n){e.querySelector(".js-char-counter").innerHTML=this.value.length,t.querySelector("textarea[name='note']").value=this.value})},initCheckoutSubmitButton(){let{cartForm:e,checkoutSubmitButton:t}=this.elms;t&&t.addEvent("click",function(){this.addClass("pending"),e.querySelector("button[name='checkout']").click()})}},g=class extends HTMLElement{constructor(){super();this.elms={totalPrice:this.querySelector(".js-total-price"),removeButton:this.querySelector(".js-remove-btn"),quantityInput:this.querySelector("quantity-input")},this.onChangeHandler(),this.onRemoveHandler()}onChangeHandler(){let{quantityInput:t,removeButton:n,totalPrice:a}=this.elms;customElements.whenDefined("quantity-input").then(()=>{t.onChange(s=>{n.addClass("pending"),Cart.change(this.dataset.key,s).then(o=>{let{final_line_price:m}=o.items.find(i=>i.key===this.dataset.key);a.innerHTML=m.toCurrency(),n.removeClass("pending"),document.dispatchEvent(new CustomEvent("cart-change",{detail:o}))})})})}onRemoveHandler(){let{removeButton:t}=this.elms;t.addEvent("click",n=>{n.preventDefault(),t.addClass("pending"),this.css("height",this.offsetHeight+"px"),Cart.remove(this.dataset.key).then(a=>{document.dispatchEvent(new CustomEvent("cart-change",{detail:a})),this.addClass("is-removing"),AT.debounce(()=>{this.remove()},500)()})})}};!customElements.get("cart-line-item")&&customElements.define("cart-line-item",g);register("cart-template",C);load("cart-template");console.log("cart-page loaded");})();
