{
  "version": 3,
  "sources": ["../../app/scripts/common/model/store-location.js", "../../app/scripts/store-location-popup.js"],
  "sourcesContent": ["export class StoreLocation {\r\n  constructor(container, mapID) {\r\n    let { mapKey } = container.dataset;\r\n    let stores = JSON.parse(container.querySelector(\"[data-location-list-json]\").innerHTML);\r\n\r\n    stores.features.forEach((store, i) => {\r\n      store.properties.id = i;\r\n    });\r\n\r\n    mapboxgl.accessToken = mapKey;\r\n    this.map = new mapboxgl.Map({\r\n      container: mapID, // container ID\r\n      style: \"mapbox://styles/mapbox/streets-v11\",\r\n      center: stores.features[0].geometry.coordinates, // starting position [lng, lat]\r\n      zoom: 9, // starting zoom\r\n    });\r\n\r\n    this.map.on(\"load\", () => {\r\n      this.buildLocationList(container, stores);\r\n      this.addMarkers(stores);\r\n      this.createPopup(stores.features[0]);\r\n    });\r\n    this.initFilterStore(container);\r\n    this.handlerSelectedStoreLOcation(stores, container);\r\n  }\r\n\r\n  createPopup({ geometry, properties }) {\r\n    const popUps = document.getElementsByClassName(\"mapboxgl-popup\");\r\n    if (popUps[0]) popUps[0].remove();\r\n\r\n    new mapboxgl.Popup({ offset: 25, closeOnClick: false })\r\n      .setLngLat(geometry.coordinates)\r\n      .setText(properties[\"Full Address\"])\r\n      .addTo(this.map);\r\n  }\r\n\r\n  buildLocationList(container, stores) {\r\n    let listings = container.querySelector(\".js-find-store-location-list\");\r\n\r\n    listings.children.forEach((li) => {\r\n      let { lat, long } = li.dataset;\r\n      li.addEvent(\"click\", () => {\r\n        let store = stores.features.find(({ properties: { Latitude, Longitude } }) => {\r\n          return Latitude == lat && Longitude == long;\r\n        });\r\n        AT.cookie.set(\"arn-selected-store-location\", JSON.stringify(store), 14);\r\n        document.dispatchEvent(new CustomEvent(\"store-location-change\"));\r\n        this.map.jumpTo({\r\n          center: store.geometry.coordinates,\r\n        });\r\n        this.createPopup(store);\r\n      });\r\n    });\r\n  }\r\n\r\n  addMarkers(stores) {\r\n    for (const marker of stores.features) {\r\n      const el = document.querySelector(\".marker.template\").cloneNode(true);\r\n      el.removeClass(\"d-none\", \"template\");\r\n      el.id = `marker-${marker.properties.id}`;\r\n\r\n      new mapboxgl.Marker(el).setLngLat(marker.geometry.coordinates).addTo(this.map);\r\n\r\n      el.addEventListener(\"click\", (e) => {\r\n        this.createPopup(marker);\r\n      });\r\n    }\r\n  }\r\n\r\n  initFilterStore(container) {\r\n    let countrySelect = container.querySelector(\".js-find-store-location-country\");\r\n    let citySelect = container.querySelector(\".js-find-store-location-city\");\r\n    let storeList = container.querySelector(\".js-find-store-location-list\");\r\n\r\n    countrySelect.addEvent(\"change\", function () {\r\n      let cities = JSON.parse(this.options[this.selectedIndex].dataset.cities);\r\n      citySelect.innerHTML = citySelect.options[0].outerHTML;\r\n      cities.forEach((city) => {\r\n        let option = document.createElement(\"option\");\r\n        option.innerText = city;\r\n        option.value = city;\r\n        citySelect.appendChild(option);\r\n      });\r\n    });\r\n\r\n    citySelect.addEvent(\"change\", function () {\r\n      let countrySelected = countrySelect.value;\r\n      storeList.children.forEach((li) => {\r\n        let { city, country } = li.dataset;\r\n\r\n        if (countrySelected == country && city == this.value) {\r\n          li.removeClass(\"d-none\");\r\n        } else {\r\n          li.addClass(\"d-none\");\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  handlerSelectedStoreLOcation(stores, container) {\r\n    let selectedStore = JSON.parse(AT.cookie.get(\"arn-selected-store-location\"));\r\n\r\n    if (!selectedStore) {\r\n      return;\r\n    }\r\n\r\n    let { Country, City, Latitude, Longitude } = selectedStore.properties;\r\n    let countrySelect = container.querySelector(\".js-find-store-location-country\");\r\n    let citySelect = container.querySelector(\".js-find-store-location-city\");\r\n    let storeList = container.querySelector(\".js-find-store-location-list\");\r\n    countrySelect.value = Country;\r\n    countrySelect.dispatchEvent(new Event(\"change\"));\r\n    citySelect.value = City;\r\n    citySelect.dispatchEvent(new Event(\"change\"));\r\n\r\n    let li = [...storeList.children].find((li) => li.dataset.lat == Latitude && li.dataset.long == Longitude);\r\n    console.log(li);\r\n    li && li.click();\r\n  }\r\n}\r\n", "import { StoreLocation } from \"./common/model\";\r\n\r\nclass PopupStoreLocation extends PopupComponent {\r\n  constructor() {\r\n    super();\r\n    let storesJSON = JSON.parse(this.querySelector(\"[data-location-list-json]\").innerHTML);\r\n    let storeListContainer = this.querySelector(\".js-find-store-location-list\");\r\n    let storeItemTemplate = storeListContainer.firstElementChild;\r\n    let countrySelect = this.querySelector(\".js-find-store-location-country\");\r\n\r\n    storesJSON.features.forEach(({ properties }) => {\r\n      let li = storeItemTemplate.cloneNode(true);\r\n\r\n      li.removeClass(\"d-none\", \"template\");\r\n      li.querySelector(\".js-name\").innerHTML = properties[\"Store Name\"];\r\n      li.querySelector(\".js-address\").innerHTML = properties[\"Full Address\"];\r\n      li.setAttribute(\"data-country\", properties[\"Country\"]);\r\n      li.setAttribute(\"data-city\", properties[\"City\"]);\r\n      li.setAttribute(\"data-lat\", properties[\"Latitude\"]);\r\n      li.setAttribute(\"data-long\", properties[\"Longitude\"]);\r\n      storeListContainer.append(li);\r\n    });\r\n\r\n    let countries = storesJSON.features.reduce((acc, { properties }) => {\r\n      acc[properties[\"Country\"]] = [...(acc[properties[\"Country\"]] || []), properties[\"City\"]];\r\n      return acc;\r\n    }, {});\r\n\r\n    Object.keys(countries).forEach((country) => {\r\n      let option = document.createElement(\"option\");\r\n      option.innerText = country;\r\n\r\n      option.dataset.cities = JSON.stringify(countries[country]);\r\n      countrySelect.append(option);\r\n    });\r\n    this.querySelectorAll(\".js-popup-close\").addEvents(\"click\", this.close.bind(this));\r\n    document.addEvent(\"store-location-popup-open\", this.open.bind(this));\r\n    document.addEvent(\"store-location-popup-open\", () => new StoreLocation(this, \"popup-map\"), { once: true });\r\n  }\r\n}\r\n\r\nlet popupTemplate = document.getElementById(\"popup-container\");\r\nlet storeLocationPopup = popupTemplate.content.querySelector(\".popup-store-location\");\r\n\r\npopupTemplate.insertAdjacentElement(\"beforebegin\", storeLocationPopup);\r\ncustomElements.define(\"popup-store-location\", PopupStoreLocation);\r\nPopups.push(\"popup-store-location\", storeLocationPopup);\r\nconsole.log(\"store-location-popup.js loaded\");\r\n"],
  "mappings": "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",
  "names": []
}
