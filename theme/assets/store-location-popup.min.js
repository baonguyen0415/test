(()=>{var d=class{constructor(o,i){let{mapKey:s}=o.dataset,n=JSON.parse(o.querySelector("[data-location-list-json]").innerHTML);n.features.forEach((r,t)=>{r.properties.id=t}),mapboxgl.accessToken=s,this.map=new mapboxgl.Map({container:i,style:"mapbox://styles/mapbox/streets-v11",center:n.features[0].geometry.coordinates,zoom:9}),this.map.on("load",()=>{this.buildLocationList(o,n),this.addMarkers(n),this.createPopup(n.features[0])}),this.initFilterStore(o),this.handlerSelectedStoreLOcation(n,o)}createPopup({geometry:o,properties:i}){let s=document.getElementsByClassName("mapboxgl-popup");s[0]&&s[0].remove(),new mapboxgl.Popup({offset:25,closeOnClick:!1}).setLngLat(o.coordinates).setText(i["Full Address"]).addTo(this.map)}buildLocationList(o,i){o.querySelector(".js-find-store-location-list").children.forEach(n=>{let{lat:r,long:t}=n.dataset;n.addEvent("click",()=>{let e=i.features.find(({properties:{Latitude:l,Longitude:a}})=>l==r&&a==t);AT.cookie.set("arn-selected-store-location",JSON.stringify(e),14),document.dispatchEvent(new CustomEvent("store-location-change")),this.map.jumpTo({center:e.geometry.coordinates}),this.createPopup(e)})})}addMarkers(o){for(let i of o.features){let s=document.querySelector(".marker.template").cloneNode(!0);s.removeClass("d-none","template"),s.id=`marker-${i.properties.id}`,new mapboxgl.Marker(s).setLngLat(i.geometry.coordinates).addTo(this.map),s.addEventListener("click",n=>{this.createPopup(i)})}}initFilterStore(o){let i=o.querySelector(".js-find-store-location-country"),s=o.querySelector(".js-find-store-location-city"),n=o.querySelector(".js-find-store-location-list");i.addEvent("change",function(){let r=JSON.parse(this.options[this.selectedIndex].dataset.cities);s.innerHTML=s.options[0].outerHTML,r.forEach(t=>{let e=document.createElement("option");e.innerText=t,e.value=t,s.appendChild(e)})}),s.addEvent("change",function(){let r=i.value;n.children.forEach(t=>{let{city:e,country:l}=t.dataset;r==l&&e==this.value?t.removeClass("d-none"):t.addClass("d-none")})})}handlerSelectedStoreLOcation(o,i){let s=JSON.parse(AT.cookie.get("arn-selected-store-location"));if(!s)return;let{Country:n,City:r,Latitude:t,Longitude:e}=s.properties,l=i.querySelector(".js-find-store-location-country"),a=i.querySelector(".js-find-store-location-city"),g=i.querySelector(".js-find-store-location-list");l.value=n,l.dispatchEvent(new Event("change")),a.value=r,a.dispatchEvent(new Event("change"));let c=[...g.children].find(u=>u.dataset.lat==t&&u.dataset.long==e);console.log(c),c&&c.click()}};var p=class extends PopupComponent{constructor(){super();let o=JSON.parse(this.querySelector("[data-location-list-json]").innerHTML),i=this.querySelector(".js-find-store-location-list"),s=i.firstElementChild,n=this.querySelector(".js-find-store-location-country");o.features.forEach(({properties:t})=>{let e=s.cloneNode(!0);e.removeClass("d-none","template"),e.querySelector(".js-name").innerHTML=t["Store Name"],e.querySelector(".js-address").innerHTML=t["Full Address"],e.setAttribute("data-country",t.Country),e.setAttribute("data-city",t.City),e.setAttribute("data-lat",t.Latitude),e.setAttribute("data-long",t.Longitude),i.append(e)});let r=o.features.reduce((t,{properties:e})=>(t[e.Country]=[...t[e.Country]||[],e.City],t),{});Object.keys(r).forEach(t=>{let e=document.createElement("option");e.innerText=t,e.dataset.cities=JSON.stringify(r[t]),n.append(e)}),this.querySelectorAll(".js-popup-close").addEvents("click",this.close.bind(this)),document.addEvent("store-location-popup-open",this.open.bind(this)),document.addEvent("store-location-popup-open",()=>new d(this,"popup-map"),{once:!0})}},h=document.getElementById("popup-container"),m=h.content.querySelector(".popup-store-location");h.insertAdjacentElement("beforebegin",m);customElements.define("popup-store-location",p);Popups.push("popup-store-location",m);console.log("store-location-popup.js loaded");})();
