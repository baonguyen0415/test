{
  "version": 3,
  "sources": ["../../app/scripts/cart-page.js"],
  "sourcesContent": ["let CartTemplate = {\r\n  onLoad() {\r\n    this.elms = {\r\n      cartSubtotalPrice: this.container.querySelector(\".js-cart-subtotal-price\"),\r\n      cartTotalPrice: this.container.querySelector(\".js-cart-total-price\"),\r\n      lineItemList: this.container.getElementsByClassName(\"js-cart-line-item\"),\r\n      lineItemsContainer: this.container.querySelector(\"#cart-line-items\"),\r\n      estimateShipping: this.container.querySelector(\"#shipping-calculator\"),\r\n      cartForm: this.container.querySelector(\"#cart-form\"),\r\n      cartNote: this.container.querySelector(\"#cart-note\"),\r\n      checkoutSubmitButton: this.container.querySelector(\"#checkout-submit-button\"),\r\n    };\r\n    document.addEvent(\"cart-change\", this.onCartChangeHandler.bind(this));\r\n    document.addEvent(\"cart-add\", this.onCartAddHandler.bind(this));\r\n    this.initEstimateShipping();\r\n    this.initCartNote();\r\n    this.initCheckoutSubmitButton();\r\n  },\r\n  onCartAddHandler({ detail: { sections, ...lineItem } }) {\r\n    let { lineItemsContainer } = this.elms;\r\n    lineItemsContainer.innerHTML = sections[\"cart-template\"];\r\n    let lineItemElement = lineItemsContainer.querySelector(`cart-line-item[data-key='${lineItem.key}']`);\r\n\r\n    AT.scrollTo(lineItemElement, 1000, 300).then(() => {\r\n      lineItemElement.addClass(\"line-item--highlight\");\r\n      AT.debounce(() => lineItemElement.removeClass(\"line-item--highlight\"), 1000);\r\n    });\r\n  },\r\n  onCartChangeHandler({ detail: { original_total_price, total_price, item_count } }) {\r\n    let { cartSubtotalPrice, cartTotalPrice } = this.elms;\r\n    cartSubtotalPrice.innerHTML = original_total_price.toCurrency();\r\n    cartTotalPrice.innerHTML = total_price.toCurrency();\r\n    this.container.setAttribute(\"data-status\", item_count);\r\n  },\r\n  initEstimateShipping() {\r\n    let { estimateShipping } = this.elms;\r\n    if (!estimateShipping) {\r\n      return;\r\n    }\r\n    let estimateShippingForm = estimateShipping.querySelector(\"form\");\r\n    let countryElement = estimateShipping.querySelector(\"#shipping-calculator-country\");\r\n    let provinceElement = estimateShipping.querySelector(\"#shipping-calculator-province\");\r\n    let provinceParentElement = provinceElement.closest(\".province\");\r\n    let messageContainer = estimateShipping.querySelector(\".js-message-container\");\r\n    let errorMessage = estimateShipping.querySelector(\".js-error-message\");\r\n    let resultsElement = estimateShipping.querySelector(\".js-shipping-calculator-results\");\r\n    let placeholderRegex = /\\{\\{\\s*(\\w+)\\s*\\}\\}/;\r\n    let listNoDecimalsFormat =\r\n      \"amount_no_decimals,amount_no_decimals_with_comma_separator,amount_no_decimals_with_space_separator\";\r\n    let defaultCountry = countryElement.dataset.default;\r\n    countryElement.addEvent(\"change\", function () {\r\n      let provinceList = JSON.parse(this.options[this.selectedIndex].dataset.provinces);\r\n      if (provinceList.length) {\r\n        provinceParentElement.removeClass(\"d-none\");\r\n        provinceList.forEach((item) => {\r\n          let option = document.createElement(\"option\");\r\n          option.value = item[0];\r\n          option.innerHTML = item[1];\r\n          provinceElement.append(option);\r\n        });\r\n      } else {\r\n        provinceParentElement.addClass(\"d-none\");\r\n        provinceElement.value = \"\";\r\n      }\r\n    });\r\n    if (defaultCountry) {\r\n      countryElement.value = defaultCountry;\r\n      countryElement.dispatchEvent(new Event(\"change\"));\r\n    }\r\n    estimateShippingForm.addEvent(\"submit\", function (e) {\r\n      e.preventDefault();\r\n      let formData = new FormData(this);\r\n      let searchParams = new URLSearchParams(formData).toString();\r\n      this.addClass(\"pending\");\r\n      fetch(`/cart/shipping_rates.json?${searchParams}`, {\r\n        dataType: \"json\",\r\n      })\r\n        .then(({ shipping_rates }) => {\r\n          messageContainer.addClass(\"d-none\");\r\n          console.log(shipping_rates);\r\n          if (shipping_rates.length) {\r\n            resultsElement.querySelector(\"p\").innerHTML =\r\n              shipping_rates.length > 1\r\n                ? theme.strings.shipping.manyRates.replace(\"{{number}}\", shipping_rates.length)\r\n                : theme.strings.shipping.oneRate;\r\n            resultsElement.querySelector(\"ul\").innerHTML = shipping_rates.reduce((accu, rate) => {\r\n              accu += `<li>${rate.name}: ${(listNoDecimalsFormat.includes(\r\n                theme.currency.format.match(placeholderRegex)[1],\r\n              )\r\n                ? rate.price * 100\r\n                : rate.price\r\n              ).toCurrency()}</li>`;\r\n              return accu;\r\n            }, \"\");\r\n          } else {\r\n            resultsElement.querySelector(\"ul\").innerHTML = \"\";\r\n            resultsElement.querySelector(\"p\").innerHTML = theme.strings.shipping.notFoundRate;\r\n          }\r\n          resultsElement.removeClass(\"d-none\");\r\n        })\r\n        .catch((error) => {\r\n          let key = Object.keys(error)[0];\r\n          errorMessage.innerHTML = `${key} ${error[key]}`;\r\n          messageContainer.removeClass(\"d-none\");\r\n          resultsElement.addClass(\"d-none\");\r\n        })\r\n        .finally(() => this.removeClass(\"pending\"));\r\n    });\r\n  },\r\n  initCartNote() {\r\n    let { cartNote, cartForm } = this.elms;\r\n    if (cartNote) {\r\n      cartNote.querySelector(\"textarea\").addEvent(\"input\", function (e) {\r\n        cartNote.querySelector(\".js-char-counter\").innerHTML = this.value.length;\r\n        cartForm.querySelector(\"textarea[name='note']\").value = this.value;\r\n      });\r\n    }\r\n  },\r\n  initCheckoutSubmitButton() {\r\n    let { cartForm, checkoutSubmitButton } = this.elms;\r\n    if (checkoutSubmitButton) {\r\n      checkoutSubmitButton.addEvent(\"click\", function () {\r\n        this.addClass(\"pending\");\r\n        cartForm.querySelector(\"button[name='checkout']\").click();\r\n      });\r\n    }\r\n  },\r\n};\r\nclass CartLineItem extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n    this.elms = {\r\n      totalPrice: this.querySelector(\".js-total-price\"),\r\n      removeButton: this.querySelector(\".js-remove-btn\"),\r\n      quantityInput: this.querySelector(\"quantity-input\"),\r\n    };\r\n    this.onChangeHandler();\r\n    this.onRemoveHandler();\r\n  }\r\n  onChangeHandler() {\r\n    let { quantityInput, removeButton, totalPrice } = this.elms;\r\n    customElements.whenDefined(\"quantity-input\").then(() => {\r\n      quantityInput.onChange((quantity) => {\r\n        removeButton.addClass(\"pending\");\r\n        Cart.change(this.dataset.key, quantity).then((res) => {\r\n          let { final_line_price } = res.items.find((item) => item.key === this.dataset.key);\r\n          totalPrice.innerHTML = final_line_price.toCurrency();\r\n          removeButton.removeClass(\"pending\");\r\n          document.dispatchEvent(new CustomEvent(\"cart-change\", { detail: res }));\r\n        });\r\n      });\r\n    });\r\n  }\r\n  onRemoveHandler() {\r\n    let { removeButton } = this.elms;\r\n    removeButton.addEvent(\"click\", (e) => {\r\n      e.preventDefault();\r\n      removeButton.addClass(\"pending\");\r\n      this.css(\"height\", this.offsetHeight + \"px\");\r\n      Cart.remove(this.dataset.key).then((res) => {\r\n        document.dispatchEvent(new CustomEvent(\"cart-change\", { detail: res }));\r\n        this.addClass(\"is-removing\");\r\n        AT.debounce(() => {\r\n          this.remove();\r\n        }, 500)();\r\n      });\r\n    });\r\n  }\r\n}\r\n!customElements.get(\"cart-line-item\") && customElements.define(\"cart-line-item\", CartLineItem);\r\nregister(\"cart-template\", CartTemplate);\r\nload(\"cart-template\");\r\nconsole.log(\"cart-page loaded\");\r\n"],
  "mappings": "MAAA,GAAI,GAAe,CACjB,QAAS,CACP,KAAK,KAAO,CACV,kBAAmB,KAAK,UAAU,cAAc,2BAChD,eAAgB,KAAK,UAAU,cAAc,wBAC7C,aAAc,KAAK,UAAU,uBAAuB,qBACpD,mBAAoB,KAAK,UAAU,cAAc,oBACjD,iBAAkB,KAAK,UAAU,cAAc,wBAC/C,SAAU,KAAK,UAAU,cAAc,cACvC,SAAU,KAAK,UAAU,cAAc,cACvC,qBAAsB,KAAK,UAAU,cAAc,4BAErD,SAAS,SAAS,cAAe,KAAK,oBAAoB,KAAK,OAC/D,SAAS,SAAS,WAAY,KAAK,iBAAiB,KAAK,OACzD,KAAK,uBACL,KAAK,eACL,KAAK,4BAEP,iBAAiB,CAAE,OAAQ,CAAE,cAAa,IAAc,CACtD,GAAI,CAAE,sBAAuB,KAAK,KAClC,EAAmB,UAAY,EAAS,iBACxC,GAAI,GAAkB,EAAmB,cAAc,4BAA4B,EAAS,SAE5F,GAAG,SAAS,EAAiB,IAAM,KAAK,KAAK,IAAM,CACjD,EAAgB,SAAS,wBACzB,GAAG,SAAS,IAAM,EAAgB,YAAY,wBAAyB,QAG3E,oBAAoB,CAAE,OAAQ,CAAE,uBAAsB,cAAa,eAAgB,CACjF,GAAI,CAAE,oBAAmB,kBAAmB,KAAK,KACjD,EAAkB,UAAY,EAAqB,aACnD,EAAe,UAAY,EAAY,aACvC,KAAK,UAAU,aAAa,cAAe,IAE7C,sBAAuB,CACrB,GAAI,CAAE,oBAAqB,KAAK,KAChC,GAAI,CAAC,EACH,OAEF,GAAI,GAAuB,EAAiB,cAAc,QACtD,EAAiB,EAAiB,cAAc,gCAChD,EAAkB,EAAiB,cAAc,iCACjD,EAAwB,EAAgB,QAAQ,aAChD,EAAmB,EAAiB,cAAc,yBAClD,EAAe,EAAiB,cAAc,qBAC9C,EAAiB,EAAiB,cAAc,mCAChD,EAAmB,sBACnB,EACF,qGACE,EAAiB,EAAe,QAAQ,QAC5C,EAAe,SAAS,SAAU,UAAY,CAC5C,GAAI,GAAe,KAAK,MAAM,KAAK,QAAQ,KAAK,eAAe,QAAQ,WACvE,AAAI,EAAa,OACf,GAAsB,YAAY,UAClC,EAAa,QAAQ,AAAC,GAAS,CAC7B,GAAI,GAAS,SAAS,cAAc,UACpC,EAAO,MAAQ,EAAK,GACpB,EAAO,UAAY,EAAK,GACxB,EAAgB,OAAO,MAGzB,GAAsB,SAAS,UAC/B,EAAgB,MAAQ,MAGxB,GACF,GAAe,MAAQ,EACvB,EAAe,cAAc,GAAI,OAAM,YAEzC,EAAqB,SAAS,SAAU,SAAU,EAAG,CACnD,EAAE,iBACF,GAAI,GAAW,GAAI,UAAS,MACxB,EAAe,GAAI,iBAAgB,GAAU,WACjD,KAAK,SAAS,WACd,MAAM,6BAA6B,IAAgB,CACjD,SAAU,SAET,KAAK,CAAC,CAAE,oBAAqB,CAC5B,EAAiB,SAAS,UAC1B,QAAQ,IAAI,GACZ,AAAI,EAAe,OACjB,GAAe,cAAc,KAAK,UAChC,EAAe,OAAS,EACpB,MAAM,QAAQ,SAAS,UAAU,QAAQ,aAAc,EAAe,QACtE,MAAM,QAAQ,SAAS,QAC7B,EAAe,cAAc,MAAM,UAAY,EAAe,OAAO,CAAC,EAAM,IAC1E,IAAQ,OAAO,EAAK,SAAU,GAAqB,SACjD,MAAM,SAAS,OAAO,MAAM,GAAkB,IAE5C,EAAK,MAAQ,IACb,EAAK,OACP,oBACK,GACN,KAEH,GAAe,cAAc,MAAM,UAAY,GAC/C,EAAe,cAAc,KAAK,UAAY,MAAM,QAAQ,SAAS,cAEvE,EAAe,YAAY,YAE5B,MAAM,AAAC,GAAU,CAChB,GAAI,GAAM,OAAO,KAAK,GAAO,GAC7B,EAAa,UAAY,GAAG,KAAO,EAAM,KACzC,EAAiB,YAAY,UAC7B,EAAe,SAAS,YAEzB,QAAQ,IAAM,KAAK,YAAY,eAGtC,cAAe,CACb,GAAI,CAAE,WAAU,YAAa,KAAK,KAClC,AAAI,GACF,EAAS,cAAc,YAAY,SAAS,QAAS,SAAU,EAAG,CAChE,EAAS,cAAc,oBAAoB,UAAY,KAAK,MAAM,OAClE,EAAS,cAAc,yBAAyB,MAAQ,KAAK,SAInE,0BAA2B,CACzB,GAAI,CAAE,WAAU,wBAAyB,KAAK,KAC9C,AAAI,GACF,EAAqB,SAAS,QAAS,UAAY,CACjD,KAAK,SAAS,WACd,EAAS,cAAc,2BAA2B,YAK1D,eAA2B,YAAY,CACrC,aAAc,CACZ,QACA,KAAK,KAAO,CACV,WAAY,KAAK,cAAc,mBAC/B,aAAc,KAAK,cAAc,kBACjC,cAAe,KAAK,cAAc,mBAEpC,KAAK,kBACL,KAAK,kBAEP,iBAAkB,CAChB,GAAI,CAAE,gBAAe,eAAc,cAAe,KAAK,KACvD,eAAe,YAAY,kBAAkB,KAAK,IAAM,CACtD,EAAc,SAAS,AAAC,GAAa,CACnC,EAAa,SAAS,WACtB,KAAK,OAAO,KAAK,QAAQ,IAAK,GAAU,KAAK,AAAC,GAAQ,CACpD,GAAI,CAAE,oBAAqB,EAAI,MAAM,KAAK,AAAC,GAAS,EAAK,MAAQ,KAAK,QAAQ,KAC9E,EAAW,UAAY,EAAiB,aACxC,EAAa,YAAY,WACzB,SAAS,cAAc,GAAI,aAAY,cAAe,CAAE,OAAQ,WAKxE,iBAAkB,CAChB,GAAI,CAAE,gBAAiB,KAAK,KAC5B,EAAa,SAAS,QAAS,AAAC,GAAM,CACpC,EAAE,iBACF,EAAa,SAAS,WACtB,KAAK,IAAI,SAAU,KAAK,aAAe,MACvC,KAAK,OAAO,KAAK,QAAQ,KAAK,KAAK,AAAC,GAAQ,CAC1C,SAAS,cAAc,GAAI,aAAY,cAAe,CAAE,OAAQ,KAChE,KAAK,SAAS,eACd,GAAG,SAAS,IAAM,CAChB,KAAK,UACJ,aAKX,CAAC,eAAe,IAAI,mBAAqB,eAAe,OAAO,iBAAkB,GACjF,SAAS,gBAAiB,GAC1B,KAAK,iBACL,QAAQ,IAAI",
  "names": []
}
